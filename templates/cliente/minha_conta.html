{% extends "base.html" %}

{% block title %}Minha Conta - SolarPro{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1 data-aos="fade-up">Minha Conta</h1>
        <p data-aos="fade-up" data-aos-delay="100">Bem-vindo(a), {{ current_user.nome }}!</p>
    </div>
</section>

<section class="account-section">
    <div class="container">
        <div class="account-layout">
            <aside class="account-sidebar" data-aos="fade-right">
                <nav class="account-nav">
                    <a href="{{ url_for('minha_conta') }}" class="active">Visão Geral</a>
                    <a href="{{ url_for('meus_pedidos') }}">Meus Pedidos</a>
                    <a href="#perfil">Meus Dados</a>
                    <a href="{{ url_for('logout') }}">Sair</a>
                </nav>
            </aside>
            
            <main class="account-main">
                <div class="account-grid">
                    <div class="account-card" data-aos="fade-up">
                        <h3>Pedidos Recentes</h3>
                        {% if pedidos %}
                            <div class="mini-orders">
                                {% for pedido in pedidos %}
                                <a href="{{ url_for('ver_pedido', id=pedido.id) }}" class="mini-order">
                                    <span class="order-id">#{{ pedido.id }}</span>
                                    <span class="order-date">{{ pedido.data|format_date }}</span>
                                    <span class="order-status status-{{ pedido.status_pedido }}">{{ pedido.status_pedido|replace('_', ' ')|title }}</span>
                                    <span class="order-total">{{ pedido.total|format_price }}</span>
                                </a>
                                {% endfor %}
                            </div>
                            <a href="{{ url_for('meus_pedidos') }}" class="btn btn-outline btn-sm">Ver todos</a>
                        {% else %}
                            <p class="empty-text">Você ainda não fez nenhum pedido.</p>
                            <a href="{{ url_for('produtos') }}" class="btn btn-primary">Começar a comprar</a>
                        {% endif %}
                    </div>
                    
                    <div class="account-card" data-aos="fade-up" data-aos-delay="100">
                        <h3>Lista de Desejos</h3>
                        {% if lista_desejos %}
                            <div class="wishlist-mini">
                                {% for produto in lista_desejos[:4] %}
                                <div class="wishlist-item">
                                    <img src="{{ product_image_url(produto.imagem) }}" alt="{{ produto.nome }}">
                                    <div class="wishlist-info">
                                        <a href="{{ url_for('produto', id=produto.id) }}">{{ produto.nome }}</a>
                                        <span>{{ produto.preco|format_price }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="empty-text">Sua lista de desejos está vazia.</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="account-card" data-aos="fade-up" id="perfil">
                    <h3>Meus Dados</h3>
                    <form method="POST" action="{{ url_for('atualizar_perfil') }}" class="profile-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nome">Nome completo</label>
                                <input type="text" id="nome" name="nome" value="{{ current_user.nome }}" required>
                            </div>
                            <div class="form-group">
                                <label for="telefone">Telefone</label>
                                <input type="tel" id="telefone" name="telefone" value="{{ current_user.telefone or '' }}">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cpf">CPF</label>
                                <input type="text" id="cpf" name="cpf" value="{{ current_user.cpf or '' }}">
                            </div>
                            <div class="form-group">
                                <label for="cep">CEP</label>
                                <input type="text" id="cep" name="cep" value="{{ current_user.cep or '' }}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="endereco">Endereço</label>
                            <input type="text" id="endereco" name="endereco" value="{{ current_user.endereco or '' }}" placeholder="Rua, número, complemento">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cidade">Cidade</label>
                                <input type="text" id="cidade" name="cidade" value="{{ current_user.cidade or '' }}">
                            </div>
                            <div class="form-group">
                                <label for="estado">Estado</label>
                                <select id="estado" name="estado">
                                    <option value="">Selecione</option>
                                    {% for uf in ['AC','AL','AP','AM','BA','CE','DF','ES','GO','MA','MT','MS','MG','PA','PB','PR','PE','PI','RJ','RN','RS','RO','RR','SC','SP','SE','TO'] %}
                                    <option value="{{ uf }}" {{ 'selected' if current_user.estado == uf else '' }}>{{ uf }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    </form>
                </div>
            </main>
        </div>
    </div>
</section>
{% endblock %}
